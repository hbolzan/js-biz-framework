import { DataField } from "../../../src/components/data_aware/data_field.js";

const mockedDataSet = {
    edit: jest.fn(),
    afterPost: jest.fn(),
};

const fieldsDefs = [
    { name: "a", default: "ABC", label: "Field A" },
    { name: "b", default: 123, label: "Field B" },
    { name: "c", label: "Field C" },
];

describe("DataField", () => {
    let dataField = DataField(fieldsDefs[0], mockedDataSet);

    it("self registers in dataset afterPost listener", () => {
        expect(mockedDataSet.afterPost).toHaveBeenCalled();
        // expect(mockedDataSet.edit).toHaveBeenCalledTimes(0);
    });

    it("is initialized with fieldDef default value", () => {
        expect(dataField.value()).toBe("ABC");
    });

    it("has all fieldDef attributes", () => {
        expect(dataField.name).toBe("a");
        expect(dataField.default).toBe("ABC");
        expect(dataField.label).toBe("Field A");
    });

    it("changes valueChanged state and triggers onChange event when a new value is set", () => {
        expect(dataField.valueChanged()).toBe(false);
        dataField.value("XYZ");
        expect(dataField.valueChanged()).toBe(true);
        expect(mockedDataSet.edit).toHaveBeenCalled();
    });

    it("triggers onChange event and calls dataSet edit method", () => {
    });

});
